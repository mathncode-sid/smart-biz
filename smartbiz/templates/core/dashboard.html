{% extends "core/base.html" %}
{% block content %}
<h3 class="fw-semibold mb-4">Dashboard</h3>

<div class="row g-4 mb-4">

    <div class="col-md-4">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h6 class="text-muted">Total Sales Today</h6>
                <p class="fs-3 fw-bold">KES {{ total_today }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h6 class="text-muted">Total Products</h6>
                <p class="fs-3 fw-bold">{{ products.count }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h6 class="text-muted">Low Stock Alerts</h6>
                <p class="fs-3 fw-bold">{{ low_stock_count }}</p>
            </div>
        </div>
    </div>

</div>

<div class="row g-4">

    <div class="col-lg-8">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h6 class="text-muted mb-3">Sales Activity</h6>
                <canvas id="salesChart" height="300"></canvas>
            </div>
        </div>
    </div>

<div class="row g-4">

    <div class="col-lg-6">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light p-3">
                <h6 class="fw-semibold mb-0">Top Products</h6>
            </div>
            <div class="card-body">
                {% if products %}
                <div class="list-group list-group-sm">
                    {% for product in products|slice:":5" %}
                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                        <div>
                            <p class="mb-0">{{ product.name }}</p>
                            <small class="text-muted">Stock: {{ product.quantity }} | Price: KES {{ product.selling_price }}</small>
                        </div>
                        {% if product.quantity < 10 %}
                        <span class="badge bg-warning">Low Stock</span>
                        {% elif product.quantity == 0 %}
                        <span class="badge bg-danger">Out</span>
                        {% else %}
                        <span class="badge bg-success">In Stock</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-0">No products yet. <a href="{% url 'product_create' %}">Add one now</a></p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light p-3">
                <h6 class="fw-semibold mb-0">Recent Sales</h6>
            </div>
            <div class="card-body">
                {% if sales_today %}
                <div class="list-group list-group-sm">
                    {% for sale in sales_today %}
                    <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">
                        <div>
                            <p class="mb-0">{{ sale.product.name }}</p>
                            <small class="text-muted">{{ sale.created_at|date:"h:i A" }} | Qty: {{ sale.quantity_sold }}</small>
                        </div>
                        <span class="fw-semibold text-success">+KES {{ sale.total_price }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-0">No sales recorded today.</p>
                {% endif %}
            </div>
        </div>
    </div>

</div>

{% endblock %}
